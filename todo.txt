refactor "main defs" into classes